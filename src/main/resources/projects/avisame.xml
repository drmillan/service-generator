<protocol 
    javaServiceException="com.mobivery.radares.logic.ServiceException"
    javaServiceExceptionListener="com.mobivery.radares.logic.ServiceExceptionListener"
    onSend="com.mobivery.radares.RadaresApplication.onSend" onReceive="com.mobivery.radares.RadaresApplication.onReceive" onError="com.mobivery.radares.RadaresApplication.onError" onTask="com.mobivery.radares.RadaresApplication.onTaskFinished">
    
    <!-- MENSAJES DE LA APP -->
	<messages>
	    <!-- Servicios de Avisame-Server -->
	    <!-- POIs -->
		<message name="getPois" service="AvisaMe" method="getPois" description="Obtiene el listado de puntos de interes (radares)" type="Post">
        	<urlPattern>
				<url address="${serverURL}/rest/poi/all" />
			</urlPattern>
			<request name="PoiRequestDTO">
				<field name="appVersion" type="string" description="Version de la API sobre la que trabajamos"/>
			</request>
			<response name="PoiResponseDTO">
				<field name="responseObject" type="PoiDTO*" description="Array con los puntos de interes"/>
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>
    	</message>
		<message name="getPoisByCountry" service="AvisaMe" method="getPoisByCountry" description="Obtiene el listado de puntos de interes por pais" type="Post">
        	<urlPattern>
				<url address="${serverURL}/rest/poi/byCountry/${countryCode}" />
			</urlPattern>
			<request name="PoiByCountryRequestDTO">
				<field name="appVersion" type="string" description="Version de la API sobre la que trabajamos"/>
				<field name="countryCode" type="string" description="Codigo del pais"/>				
			</request>
			<response name="PoiByCountryResponseDTO">
			    <field name="mapVersion" type="string" description="Version del mapa"/>
				<field name="responseObject" type="PoiDTO*" description="Array con los puntos de interes"/>
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>
    	</message>    	
		<message name="getPoisPacked" service="AvisaMe" method="getPoisPacked" description="Obtiene el listado de puntos de interes (radares) en una sola entrada para optimizar memoria" type="Post">
        	<urlPattern>
				<url address="${serverURL}/rest/poi/allPacked" />
			</urlPattern>
			<request name="PoiPackedRequestDTO">
				<field name="appVersion" type="string" description="Version de la API sobre la que trabajamos"/>
			</request>
			<response name="PoiPackedResponseDTO">			    
				<field name="responseObject" type="string" description="Array con los puntos de interes"/>
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>
    	</message>
		<message name="getPoisByCountryPacked" service="AvisaMe" method="getPoisByCountryPacked" description="Obtiene el listado de puntos de interes por pais en una sola entrada para optimizar memoria" type="Post">
        	<urlPattern>
				<url address="${serverURL}/rest/poi/byCountryPacked/${countryCode}" />
			</urlPattern>
			<request name="PoiByCountryPackedRequestDTO">
				<field name="appVersion" type="string" description="Version de la API sobre la que trabajamos"/>
				<field name="countryCode" type="string" description="Codigo del pais"/>				
			</request>
			<response name="PoiByCountryPackedResponseDTO">
			    <field name="mapVersion" type="string" description="Version del mapa"/>
				<field name="responseObject" type="string" description="Array con los puntos de interes"/>
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>
    	</message>       	
		<message name="checkVersion" service="AvisaMe" method="checkVersion" description="Comprobar la version de los pois que tenemos" type="Post">
        	<urlPattern>
				<url address="${serverURL}/rest/poi/checkVersion" />
			</urlPattern>
			<request name="CheckVersionRequestDTO">
				<field name="appVersion" type="string" description="Version de la API sobre la que trabajamos"/>
				<field name="countryCode" type="string" description="Codigo del pais"/>				
				<field name="mapVersion" type="string" description="Version del mapa (?)"/>								
			</request>
			<response name="CheckVersionResponseDTO">
				<field name="responseObject" type="int" description="Numero de la version"/>
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>
    	</message>    	    	
    	<!-- PROBLEMAS -->
		<message name="getIssues" service="AvisaMe" method="getIssues" description="Obtener los problemas" type="Get">
        	<urlPattern>
				<url address="${serverURL}/rest/issue/all" />
			</urlPattern>
			<request name="GetIssuesRequestDTO">
			</request>
			<response name="GetIssuesResponseDTO">
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
				<field name="responseObject" type="ProblemDTO*" description="Problemas reportados" />
			</response>
    	</message>    	
		<message name="reportIssue" service="AvisaMe" method="reportIssue" description="Notificar un problema" type="Post">
        	<urlPattern>
				<url address="${serverURL}/rest/issue/add" />
			</urlPattern>
			<request name="ReportIssueRequestDTO">
				<field name="description" type="string" description="Descripcion del problema"/>
				<field name="responseEmail" type="string" description="Correo de contacto (puede ir vacio)"/>				
			</request>
			<response name="ReportIssueResponseDTO">
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>
    	</message>
    	<message name="getUnansweredIssues" service="AvisaMe" method="getUnansweredIssues" description="Obtener los problemas sin contestar" type="Get">
        	<urlPattern>
				<url address="${serverURL}/rest/issue/unanswered" />
			</urlPattern>
			<request name="GetIssuesRequestDTO">
			</request>
			<response name="GetIssuesResponseDTO">
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
				<field name="responseObject" type="ProblemDTO*" description="Problemas reportados" />
			</response>
    	</message>
    	<message name="replyIssue" service="AvisaMe" method="replyIssue" description="Envia una respuesta por mail a un problema" type="Post">
        	<urlPattern>
				<url address="${serverURL}/rest/issue/reply" />
			</urlPattern>
			<request name="ReplyIssueRequestDTO">
				<field name="id" type="int" description="Identificador unico"/>
				<field name="message" type="string" description="Mensaje de respuesta al problema"/>				
			</request>
			<response name="ReplyIssueResponseDTO">
				<field name="message" type="string" description="Status peticion"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>
    	</message>
    	<!-- AÑADIR POI -->
		<message name="addPOI" service="AvisaMe" method="addPOI" description="Añade un POI" type="Post">
			<urlPattern>
				<url address="${serverURL}/rest/poi/addPOI" />
			</urlPattern>
			<request name="AddPOIRequestDTO">
				<field name="userId" type="string" description="Identificador de usuario"/>
				<field name="latitude" type="double" description="Latitud"/>
				<field name="longitud" type="double" description="Longitud"/>
				<field name="bearing" type="double" description="Direccion"/>
				<field name="speed" type="double" description="Velocidad"/>
				<field name="dateAdded" type="int" description="Fecha de inserción yyyyMMddHHmmss"/>				
			</request>
			<response name="AddPOIResponseDTO">
				<field name="message" type="int" description="Id del poi"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>		
		</message>
		<!-- MARCAR POI Incorrecto-->
		<message name="markPOIError" service="AvisaMe" method="markPOIError" description="Marca un POI erroneo" type="Post">
			<urlPattern>
				<url address="${serverURL}/rest/poi/poiError" />
			</urlPattern>
			<request name="MarkPOIErrorRequestDTO">
				<field name="poiId" type="int" description="identificador POI incorrecto"/>
				<field name="userId" type="string" description="Identificador de usuario"/>				
				<field name="latitude" type="double" description="Latitud"/>
				<field name="longitud" type="double" description="Longitud"/>
				<field name="bearing" type="double" description="Direccion"/>
				<field name="speed" type="double" description="Velocidad"/>
				<field name="dateAdded" type="int" description="Fecha de inserción yyyyMMddHHmmss"/>				
			</request>
			<response name="MarkPOIErrorResponseDTO">
				<field name="message" type="int" description="Id del poi"/>
				<field name="errorCode" type="int" description="Codigo de error"/>
			</response>		
		</message>
		
		
		
		
		<!-- Servicios de Direcciones -->
		<message name="addressesContainingTextWS" service="Addresses" method="addressesContainingTextWS" description="Devuelve un array de AddressDTO con las direcciones que coincidan con el texto que se pasa como parametro" type="Post">
			<urlPattern>				
				<url address="https://maps.googleapis.com/maps/api/geocode/json?address=${address}&amp;region=${region}&amp;sensor=true"/>
			</urlPattern>
			<request type="AddressesContainingTextWSRequestDTO">				
				<field name="address" type="string" description="Texto para buscar coincidencias de direcciones existentes" />
				<field name="region" type="string" description="Codigo de region donde se encuentra el usuario para facilitar la busqueda. Ej: es" />
			</request>
			<response type="AddressesContainingTextWSResponseDTO">
				<field name="status" type="string" description="Estado de la peticion: https://developers.google.com/maps/documentation/directions/?hl=es#StatusCodes"/>
				<field name="results" type="AddressDTO*" description="Direcciones obtenidas"/>
			</response>
		</message>
		<message name="pointsOfRouteBetweenOriginAndDestinationWS" service="Addresses" method="pointsOfRouteBetweenOriginAndDestinationWS" description="Metodo que obtiene las coordenadas para dibujar una ruta entre el origen y destino que se pasa como parametro" type="Post">
			<urlPattern>				
				<url address="https://maps.googleapis.com/maps/api/directions/json?origin=${origin}&amp;destination=${destination}&amp;alternatives=${alternatives}&amp;units=${units}&amp;region=${region}&amp;sensor=true"/>
			</urlPattern>
			<request type="PointsOfRouteBetweenOriginAndDestinationWSRequestDTO">				
				<field name="origin" type="string" description="String con el nombre del origen o sus coordenadas latitud y longitud separadas por coma sin espacios" />
				<field name="destination" type="string" description="String con el nombre del destino o sus coordenadas latitud y longitud separadas por coma sin espacios" />				
				<field name="alternatives" type="string" description="True si queremos que devuelva posibles rutas alternativas y false en caso contrario" />				
				<field name="units" type="string" description="Tipos de unidades para las distancias: metric o imperial" />
				<field name="region" type="string" description="Codigo de region donde se encuentra el usuario para facilitar la busqueda. Ej: es" />
			</request>
			<response type="PointsOfRouteBetweenOriginAndDestinationWSResponseDTO">
				<field name="status" type="string" description="Estado de la peticion: https://developers.google.com/maps/documentation/directions/?hl=es#StatusCodes"/>
				<field name="routes" type="RoutesDTO*" description="Rutas obtenidas"/>
			</response>
		</message>
    </messages>
    
	<!-- TIPOS DE LA APP -->
	<types>	
		<type name="PoiDTO">
		    <field name="id" type="int" description="Identificador unico"/>
		    <field name="latitude" type="double" description="Latitud"/>
		    <field name="longitude" type="double" description="Longitud"/>
		    <field name="poiType" type="int" description="Tipo de POI (1 – fixed speed camera locations; 2 – combined red light and speed cameras; 3 – fixed red light camera locations; 4 – section camera positions; 5 – lasers, hand-held radars and other mobile speed camera locations; 6 – railway crossing; 7 – not constant mobile locations)"/>
		    <field name="dirType" type="int" description="Tipo de direccion (?)"/>
		    <field name="direction" type="int" description="Grados de orientacion del radar"/>
		    <field name="description" type="string" description="Descripcion del poi"/>
		    <field name="countryCode" type="string" description="Codigo del pais"/>		    		    		    
		    <field name="speed" type="int" description="Limite de velocidad en el poi"/>		    		    		    
		    <field name="road" type="string" description="Calle en la que se encuentra el poi"/>		    		    		    
		</type>
		<type name="ProblemDTO">
		    <field name="id" type="int" description="Identificador unico"/>
		    <field name="description" type="int" description="Descripcion"/>
		    <field name="responseEmail" type="int" description="Correo electronico al que contestar"/>
		    <field name="dateAdded" type="int" description="Fecha en que fue notificado el problema"/>		    		    		    
		</type>
		<type name="AddressDTO">
	        <field name="formatted_address" type="string" description="Descripcion larga de la direccion"/>
	        <field name="geometry" type="GeometryDTO" description="Datos geometricos de la direccion"/>
	    </type>
		<type name="GeometryDTO">
	        <field name="location" type="LocationCoordinateDTO" description="Latitud y longitud de una ubicacion"/>
			<field name="bounds" type="BoundsDTO" description="Limites a mostrar en el mapa para visualizar la localizacion"/>
	    </type>
		<type name="BoundsDTO">
	        <field name="northeast" type="LocationCoordinateDTO" description="Latitud y longitud noreste de los limites para la localizacion"/> -->
			<field name="southwest" type="LocationCoordinateDTO" description="Latitud y longitud suroeste de los limites para la localizacion"/>
	    </type>
		<type name="LocationCoordinateDTO">
	        <field name="lat" type="double" description="Latitud"/>
		    <field name="lng" type="double" description="Longitud"/>
	    </type>
		<type name="RoutesDTO">
	        <field name="bounds" type="BoundsDTO" description="Limites a mostrar en el mapa para visualizar la ruta"/>
		    <field name="legs" type="LegsDTO*" description="Trayectos de la ruta"/>
			<field name="overview_polyline" type="OverviewPolylineDTO" description="Polilinea para trazar la linea de la ruta sobre el mapa"/>
	    </type>
		<type name="LegsDTO">
	        <field name="distance" type="DistanceDTO" description="Distancia de la ruta"/>
		    <field name="duration" type="DurationDTO" description="Duracion en tiempo de la ruta"/>
	    </type>
		<type name="DistanceDTO">
	        <field name="text" type="string" description="Distancia de la ruta en las unidades que se han solicitado: km o mi"/>
	    </type>
		<type name="DurationDTO">
	        <field name="text" type="string" description="Duracion en tiempo de la ruta"/>
	    </type>
		<type name="OverviewPolylineDTO">
	        <field name="points" type="string" description="String que los valores que forman la polilinea"/>
	    </type>
	</types>
</protocol>